services:
  nginx:
    image: nginx:alpine
    ports:
      - 80:80
    networks:
      - wwn_mgr_network
    depends_on:
      - wwn_webapi
    restart: always
    volumes:
      - ./nginx/conf/:/etc/nginx/conf.d/:ro
      - ./dist/:/usr/share/nginx/html/wwnmgr/:ro
  wwn_webapi:
    build:
      context: .
      dockerfile: ./webapi/Dockerfile
    image: wwn_webapi:0.0.1
    networks:
      - wwn_mgr_network
    restart: always
    depends_on:
      - mongodb
    volumes:
      - ./logs:/app/logs
      - ./.env:/app/.env:ro
    environment:
      MONGO_URI: mongodb://mongodb_wwnmgr:27017/
  frontend-artifacts:
    build:
      context: .
      dockerfile: ./frontend/Dockerfile 
    volumes:
      - ./dist:/output
    entrypoint: sh -c
    command: ["cp -r /app/dist/* /output/"]
  mongodb:
    image: mongo:7
    container_name: mongodb_wwnmgr
    restart: always
    networks:
      - wwn_mgr_network
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db
networks:
  wwn_mgr_network: {}
volumes:
  mongo-data: